<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DIRT Citizen Science Module: DIRT Citizen Science Module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DIRT Citizen Science Module
   </div>
   <div id="projectbrief">Custom Drupal module for DIRT Citizen Science Data Portal</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DIRT Citizen Science Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>The DIRT Citizen Science Core module provides a web-based data portal for collecting data from citizen scientists.</p>
<p>This module was created manage data collection for the <a href="https://modirt.missouriepscor.org/">MO DIRT</a> (Missourians Doing Impact Research Together) project, and thus is primarily set up to collect soil health data such as soil respiration and chemical soil properties, as well as basic information about the collection sites themselves (location, habitat type, land management practices, etc.)</p>
<h2>Overview</h2>
<p>After installing the module, the web site is initially populated with suggested data entry portal pages and data collection surveys. The four survey types are:</p>
<ul>
<li><em>Group Information Survey</em>: Information about the Citizen Scientist participants (e.g., group name, group members).</li>
<li><em>Site Description Survey</em>: Information about the collection site (e.g., site address, GSP coordinates, habitat, land management practices).</li>
<li><em>Monthly Data Survey</em>: Site variables collected monthly, such as soil respiration and soil water content. Some fields are calculated automatically for the participants on this survey.</li>
<li><em>Twice a Year Survey</em>: Site variables collected twice a year (defaults to May and August of the calendar year), such as soil pH and active carbon.</li>
</ul>
<p>The DIRT DataTable module extends the DIRT Citizen Science Core module to provide a Data Search Portal, a searchable interface for sharing collected soil data with the general public. The Data Search Portal consists of a table of all collected soil data, searchable by Site ID, habitat type, variable category, county, and survey date range, and a map of collection sites (if enabled).</p>
<h2>Uses</h2>
<ul>
<li>Collecting Citizen Science survey data Citizen Scientists request data entry accounts via the web site. After setting up an account and logging in, they have access to all of the surveys via the Data Entry Portal.</li>
<li>Sharing Citizen Science data with the public If the DIRT DataTable module is enabled, a Data Search Portal is created that displays all collected Citizen Science survey data in a searchable table and optionally includes a map of all collection sites.</li>
<li>Exporting Citizen Science data If the DIRT DataTable module is enabled, the Data Search table includes options to export all survey data as a spreadsheet in XLS or CSV format.</li>
<li>Managing data access The DIRT Core module provides a user profile field that allows participants to control access to their data ("public", "semi-public", i.e., accessible to other participants only, or "semi-private"). The most restrictive option is called "semi-private" because site administrators have access to all data submitted. The "Data Entry Account" role is created as part of this module to assign to Citizen Scientist participants, allowing them to view all other "semi-public" surveys. The DIRT DataTable module extends this core functionality to allow members of the general public (in particular, soil scientists) to request access to all of the data, including the "semi-private" data. The requests are stored in the database, pending admin approval. Approved accounts are given the "Data Viewing 
Account" role, also created as part of the module.</li>
<li>Managing collection schedules The Data Entry Portal keeps track of the collection start date for each site and prompts participants to enter surveys as scheduled (e.g., every month for monthly surveys).</li>
<li>Displaying survey history The Data Entry Portal keeps track of all surveys submitted for each site. Participants may review all of their previously submitted surveys via the portal and make changes to survey fields if necessary.</li>
<li>Educating the public about the project The module provides a basic site layout with suggested content pages and menus to describe the project to the public. Suggested pages include a page to upload resources (such as a data entry manual), a page to keep track of upcoming or past training sessions (if applicable), and a page to provide basic statistics on the project demographics, such as number of active sites, number of participating institutions/organizations, etc.</li>
</ul>
<h2>Requirements</h2>
<p>The DIRT module requires the following contributed modules:</p>
<ul>
<li>Chaos Tool Suite (<a href="https://www.drupal.org/project/ctools">https://www.drupal.org/project/ctools</a>)</li>
<li>Date (<a href="https://www.drupal.org/project/date">https://www.drupal.org/project/date</a>)</li>
<li>Entity API (<a href="https://www.drupal.org/project/entity">https://www.drupal.org/project/entity</a>)</li>
<li>Field Collection (<a href="https://www.drupal.org/project/field_collection">https://www.drupal.org/project/field_collection</a>)</li>
<li>Field Collection Table (<a href="https://www.drupal.org/project/field_collection_table">https://www.drupal.org/project/field_collection_table</a>)</li>
<li>Field Group (<a href="https://www.drupal.org/project/field_group">https://www.drupal.org/project/field_group</a>)</li>
<li>Markup (<a href="https://www.drupal.org/project/markup">https://www.drupal.org/project/markup</a>)</li>
<li>Select (or other) (<a href="https://www.drupal.org/project/select_or_other">https://www.drupal.org/project/select_or_other</a>)</li>
</ul>
<p>The DIRT DataTable module additionally requires these modules:</p>
<ul>
<li>jQuery Update (<a href="https://www.drupal.org/project/jquery_update">https://www.drupal.org/project/jquery_update</a>)</li>
<li>Libraries API (<a href="https://www.drupal.org/project/libraries">https://www.drupal.org/project/libraries</a>)</li>
</ul>
<p>DIRT DataTable also requires the following jQuery plug-in:</p>
<ul>
<li>Chosen (<a href="https://harvesthq.github.io/chosen">https://harvesthq.github.io/chosen</a>)</li>
</ul>
<h2>Configuration</h2>
<p>After installation, navigate to admin/config/dirt to access the configuration pages. The first option, DIRT Survey Configuration, contains configuration settings related to the surveys:</p>
<ul>
<li><em>Survey types</em>: Displays all current survey types in the system and allows for adding or deleting survey types.</li>
<li><em>Site description surveys</em>: Choose whether to allow participants to edit their site description survey entries.</li>
<li><em>Duplicate surveys</em>: Checks for potential duplicate surveys in the system (i.e., two or more surveys of the same type submitted from the same account in the same month and year). Also provides the option of sending e-mail notifications whenever a potential duplicate survey is submitted.</li>
</ul>
<p>The second option, DIRT Data Entry Portal Configuration, contains configuration settings related to the Data Entry Portal:</p>
<ul>
<li><em>Data Entry Portal settings</em>: Displays a list of pre-installed data entry portal pages. Also sets the project start year (defaults to year that module was installed).</li>
<li><em>Site ID lookup</em> Provides a form to search for Site IDs matching a given habitat type and participant full name.</li>
</ul>
<p>If the DIRT DataTable module is installed, a third option will appear containing configuration settings for the Data Search Portal:</p>
<ul>
<li><em>Summary</em>: Displays a summary of all collection sites and pre-installed data search portal pages in the system.</li>
<li><em>Map</em>: Choose whether to display a map of collection sites on the data search portal page and related configuration settings (map center, initial zoom level, etc.).</li>
<li><em>Data Access</em> Choose whether to allow users to fill out a form to request access to all data (including semi-private data) in the system. Accounts will need to be approved manually by site admins before they are allowed to log in and view data.</li>
<li><em>Data table groups</em>: Configure the data search table column and filter groups.</li>
<li><em>Data table columns</em>: Configure the data search table columns.</li>
<li><em>Update data table</em>: Force a manual update of the data search table database.</li>
</ul>
<h2>Data Collection</h2>
<h3>Data Collection Cycle</h3>
<p>The collection cycle goes by calendar year (January to December). Participants may join the project at any time and begin collecting at any month. The one-time surveys should be filled out as soon as the data collection begins. Monthly surveys should be filled out once a month, taking care to submit only one survey per calendar month. Twice a year surveys are collected in May and August of each calendar year.</p>
<p>While the system has some functionality programmed in to validate the surveys and keep track of the survey collection schedule, it is ultimately the responsibility of the participants and/or the site administrators to ensure that the surveys are being submitted as expected (e.g., at the correct frequency, no more than one monthly survey per calendar month, etc.).</p>
<p>Collection frequency is specified by months (e.g., monthly, every 3 months, every 6 months, etc.) There is currently no support for collection frequencies shorter than 1 month intervals. Additionally, the DIRT DataTable requires that, for each survey type, no more than one survey per account be submitted per month. The Data Search table groups together surveys to display all variables collected at a site in a single month in the same table row. "Duplicate" surveys (two or more surveys of the same type, submitted in the same survey month and year, for the same collection site) cannot be grouped together in such a way and will yield incorrect results in the search table. Currently, the DIRT DataTable module does not enforce the one-survey-per-type- per-month rule, but it does track the duplicate surveys to be reviewed by the site admins. There is also an option to automatically send e-mail notifications to site admins whenever a duplicate survey is submitted. More information on this can be found on the duplicate survey configuration page at admin/config/dirt/surveys/duplicates.</p>
<h3>Survey Fields</h3>
<p>Each survey consists of two categories of fields. Most of the fields are <em>variables</em>, i.e., fields containing the collected soil health data (e.g., habitat type, soil temperature, soil pH, etc.) The other fields store data collection <em>metadata</em> (e.g., date of survey). Some of these fields in the second category are simply used to format the surveys (e.g., the header markup field).</p>
<p><em>IMPORTANT:</em> Each variable should appear in no more than one survey. The assumption is that participants will collect variables at various frequencies (monthly, twice a year, etc.), so it does not make sense for a particular variable to appear more than once. Otherwise, there would be months where participants would enter the variable twice in both surveys for the same survey date, which could introduce inconsistencies in the collection. The DIRT Core fields satisfy this requirement. If any new variable fields are added and/or new survey types are created, they must be entirely new fields. (In Drupal terminology, the requirement is that each variable field must only have one field instance.)</p>
<p>The fields in the second category are those which every survey has in common (and thus the rule above does not apply to these fields). For example, every survey must have a collection date. The fields assigned to every survey type are:</p>
<ul>
<li>Date of survey</li>
<li>Form header</li>
<li>Form submission instructions</li>
</ul>
<p>If DIRT DataTable is installed, there are two additional fields attached to each survey, visible only to site administrators:</p>
<ul>
<li>Include survey in data portal</li>
<li>Data curation notes</li>
</ul>
<p>These fields are automatically added to content types which are designated as survey types (see next section for more details) and removed when a content type is no longer assigned as a survey type.</p>
<h3>Survey types</h3>
<p>Content types may be designated as survey types, meaning that they contain data collection fields and appear in the Data Entry Portal (and Data Search Portal, if DIRT DataTable is installed). Refer to the Overview(#overview) section for a list of the core content types with their descriptions.</p>
<p>Survey types may be added or removed via the admin config page at admin/config/dirt/surveys. <em>Note:</em> Built-in content types may not be deleted from the system, but they may be removed as survey types via this form.</p>
<h2>Customizing Content</h2>
<h2>Customizing via Web UI</h2>
<p>General procedure for adding/removing fields and/or survey content types:</p>
<ol type="1">
<li>Install the DIRT Core module, but do NOT install the DIRT DataTable module at this time.</li>
<li>Add content types and fields via the Drupal UI as usual. Delete any of the non-locked fields from the forms, if desired.</li>
<li>Add these new content types as survey types via the DIRT Survey Configuration admin form at admin/config/dirt/surveys. This form may also be used to remove any of the core survey types.</li>
<li>After surveys and fields are set up, the Data Entry Portal will be ready. If also using the DIRT DataTable module, install it at this time. All of the existing survey fields in the system will automatically be added to the Data Search Portal table.</li>
<li>Core fields will automatically be added to column groups and filter groups, but fields created via the UI will need to be added to column groups (and, optionally, field groups). Begin with the table column groups configuration at admin/config/dirt/data-search/table-groups to add, edit, or remove column groups. The same form may be used to update variable filter groups, if desired. Then, click on the "Data table columns" tab at admin/config/dirt/data-search/table-columns to add columns to column groups. This form may also be used to edit column labels and column visibility.</li>
</ol>
<p>Once the module is installed, no further changes may be made to the Data Search Portal columns beyond those allowed on the admin config forms. To add a new survey type or field to the table, uninstall the DIRT DataTable module, make the changes via the Drupal UI, and reinstall the module.</p>
<p>Uninstalling the DIRT DataTable module will NOT delete any existing surveys in the system; it only removes the Data Search Portal page and deletes the underlying database tables used in implementing the search portal functionality. Likewise, the module must be uninstalled and reinstalled to delete a survey type or field.</p>
<p>Refer to the Supported Field Types(#supported-field-types) section for a list of field types that may be added to the Data Search Portal table.</p>
<p><em>WARNING:</em> Some DIRT Core fields are required for the site to function propertly and therefore must not be deleted. In particular, the following fields should not be removed:</p>
<p>User profile fields:</p><ul>
<li>Data sharing permissions</li>
<li>Collection status</li>
<li>Collection start</li>
</ul>
<p>Survey fields:</p><ul>
<li>Date of survey</li>
<li>Form header</li>
<li>Form submission instructions</li>
<li>Habitat type</li>
<li>Geographical Coordinates in Decimal Degrees</li>
<li>Include survey in data portal</li>
<li>Data curation notes</li>
</ul>
<p>Note that markup fields (form header, form submission instructions) can be editied via the web UI to customize the markup. Also, any unused fields may be hidden in both the form and display on the content type config page, and set to hidden in the data search table via the admin config form at admin/config/dirt/data-search/table-columns.</p>
<h2>Customizing Programmatically</h2>
<p>For more advanced Drupal users, an alternative to the above procedure is to write a custom module that uses hook_schema_alter() upon installation to update the appropriate tables to include new survey types and/or survey fields (either added via UI or in the module code). The MO DIRT module uses this method to add a new survey type and make customizations specific to the MO DIRT project.</p>
<p>If using the DIRT DataTable module, install it first and define it as a dependency in the new add-on module. Add fields either via the Drupal UR or programmatically in the module. Then, there are three steps to add the new field to the data search table:</p>
<ol type="1">
<li>Update the data table schema to add a column for this field in the schema. Use the function <a class="el" href="dirt__datatable_8module.html#ae8c7077a1381e164963200b5cd0e7a1c">dirt_datatable_add_column_to_data_table_schema()</a> within hook_schema_alter().</li>
</ol>
<p>Example usage:</p>
<div class="fragment"><div class="line">$field_name = <span class="stringliteral">&#39;field_mymodule_example&#39;</span>;</div><div class="line"><span class="comment">// Call with last parameter set to TRUE to get schema fields only</span></div><div class="line">$columns = <a class="code" href="dirt__datatable_8module.html#a76e7c95dbdc9c29ce2108bb34ae64604">dirt_datatable_get_column_metadata_from_active_node_field</a>($field_name, TRUE);</div><div class="line"><span class="keywordflow">foreach</span>($columns as $column_name =&gt; $column_info) {</div><div class="line">  <a class="code" href="dirt__datatable_8module.html#ae8c7077a1381e164963200b5cd0e7a1c">dirt_datatable_add_column_to_data_table_schema</a>($column_info, $schema);</div><div class="line">}</div></div><!-- fragment --><ol type="1">
<li>Update the data table in the database to add the column. Use db_add_field().</li>
</ol>
<p>Example usage:</p>
<div class="fragment"><div class="line">$new_schema = array();</div><div class="line">hook_schema_alter($new_schema);</div><div class="line"><span class="keywordflow">if</span> (isset($new_schema[DIRT_SEARCH_TABLE_DATA][<span class="stringliteral">&#39;fields&#39;</span>])) {</div><div class="line">  <span class="keywordflow">foreach</span>($new_schema[DIRT_SEARCH_TABLE_DATA][<span class="stringliteral">&#39;fields&#39;</span>] as $field_name =&gt; $field_spec) {</div><div class="line">    db_add_field(DIRT_SEARCH_TABLE_DATA, $field_name, $field_spec);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><ol type="1">
<li>Add a row to the column metadata table with the info for this field. Use the function <a class="el" href="dirt__datatable_8module.html#a7a6ec0b5a56373d83bab71bb860c9203">dirt_datatable_add_column_metadata_for_field()</a>.</li>
</ol>
<p>Example usage:</p>
<div class="fragment"><div class="line">$field_name = <span class="stringliteral">&#39;field_example&#39;</span>;</div><div class="line">$columns = <a class="code" href="dirt__datatable_8module.html#a76e7c95dbdc9c29ce2108bb34ae64604">dirt_datatable_get_column_metadata_from_active_node_field</a>($field_name);</div><div class="line"><span class="keywordflow">foreach</span>($columns as $column_name =&gt; $column_info) {</div><div class="line">  <span class="comment">// Optionally specify additional fields in $column_info:</span></div><div class="line">  <span class="comment">// $column_info[&#39;colgroup&#39;] = $column_group_id;</span></div><div class="line">  <span class="comment">// $column_info[&#39;weight&#39;] = $weight;</span></div><div class="line">  <a class="code" href="dirt__datatable_8module.html#a7a6ec0b5a56373d83bab71bb860c9203">dirt_datatable_add_column_metadata_for_field</a>($column_info);</div><div class="line">}</div></div><!-- fragment --><h2>Supported Field Types</h2>
<p>Currently, these are the field types supported by the DIRT DataTable module:</p>
<ul>
<li>Boolean</li>
<li>Date (date module)</li>
<li>Decimal</li>
<li>Field Collection (field collection module)</li>
<li>Float</li>
<li>Integer</li>
<li>List (text)</li>
<li>List (integer)</li>
<li>List (float)</li>
<li>Text</li>
</ul>
<p><em>Important:</em> For field collections, the member fields must be supported types, and the cardinality of each member field must be limited to one. The overall field collection may have any <em>finite</em> cardinality (cannot be unlimited, as the number of database columns must be known in advance). Additionally, it is assumed that the first field in the collection defines the field order (e.g., replicate number, sample number, etc.) This field is only used to define the column order in the database table and is otherwise ignored. The core field "Replicate Number" (field_dirt_replicate_number) may be used as the first field. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
